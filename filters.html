
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Filters and Events &#8212; web3j 4.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command Line Tools" href="command_line.html" />
    <link rel="prev" title="Recursive Length Prefix" href="rlp.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
    <link rel="canonical" href="https://web3j.readthedocs.io/filters.html"/>
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="filters-and-events">
<h1>Filters and Events<a class="headerlink" href="#filters-and-events" title="Permalink to this headline">¶</a></h1>
<p>Filters provide notifications of certain events taking place in the Ethereum network. There are
three classes of filter supported in Ethereum:</p>
<ol class="arabic simple">
<li>Block filters</li>
<li>Pending transaction filters</li>
<li>Topic filters</li>
</ol>
<p>Block filters and pending transaction filters provide notification of the creation of new
transactions or blocks on the network.</p>
<p>Topic filters are more flexible. These allow you to create a filter based on specific criteria
that you provide.</p>
<p>Unfortunately, unless you are using a WebSocket connection to Geth, working with filters via the
JSON-RPC API is a tedious process, where you need to poll the Ethereum client in order to find out
if there are any updates to your filters due to the synchronous nature of HTTP and IPC requests.
Additionally the block and transaction filters only provide the transaction or block hash, so a
further request is required to obtain the actual transaction or block referred to by the hash.</p>
<p>web3j’s managed <a class="reference external" href="https://github.com/web3j/web3j/blob/master/core/src/main/java/org/web3j/protocol/core/filters/Filter.java">Filter</a>
implementation address these issues, so you have a fully asynchronous event based API for working
with filters. It uses <a class="reference external" href="https://github.com/ReactiveX/RxJava">RxJava</a>’s
<a class="reference external" href="http://reactivex.io/RxJava/2.x/javadoc/io/reactivex/Flowable.html">Flowables</a> which provides a consistent API
for working with events, which facilitates the chaining together of JSON-RPC calls via
functional composition.</p>
<p><strong>Note:</strong> filters are not supported on Infura.</p>
<div class="section" id="block-and-transaction-filters">
<h2>Block and transaction filters<a class="headerlink" href="#block-and-transaction-filters" title="Permalink to this headline">¶</a></h2>
<p>To receive all new blocks as they are added to the blockchain (the false parameter specifies that
we only want the blocks, not the embedded transactions too):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">blockFlowable</span><span class="o">(</span><span class="kc">false</span><span class="o">).</span><span class="na">subscribe</span><span class="o">(</span><span class="n">block</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>To receive all new transactions as they are added to the blockchain:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">transactionFlowable</span><span class="o">().</span><span class="na">subscribe</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>To receive all pending transactions as they are submitted to the network (i.e. before they have
been grouped into a block together):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">pendingTransactionFlowable</span><span class="o">().</span><span class="na">subscribe</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>Subscriptions should always be cancelled when no longer required via <em>unsubscribe</em>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">subscription</span><span class="o">.</span><span class="na">unsubscribe</span><span class="o">();</span>
</pre></div>
</div>
<p>Other callbacks are also provided which provide simply the block or transaction hashes,
for details of these refer to the
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/core/src/main/java/org/web3j/protocol/rx/Web3jRx.java">Web3jRx</a>
interface.</p>
</div>
<div class="section" id="replay-filters">
<h2>Replay filters<a class="headerlink" href="#replay-filters" title="Permalink to this headline">¶</a></h2>
<p>web3j also provides filters for replaying block and transaction history.</p>
<p>To replay a range of blocks from the blockchain:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">replayBlocksFlowable</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">startBlockNumber</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">endBlockNumber</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">fullTxObjects</span><span class="o">&gt;)</span>
        <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">block</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>To replay the individual transactions contained within a range of blocks:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">replayTransactionsFlowable</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">startBlockNumber</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">endBlockNumber</span><span class="o">&gt;)</span>
        <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>You can also get web3j to replay all blocks up to the most current, and provide notification
(via the submitted Flowable) once you’ve caught up:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">replayPastBlocksFlowable</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">startBlockNumber</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">fullTxObjects</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">onCompleteFlowable</span><span class="o">&gt;)</span>
        <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">block</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>Or, if you’d rather replay all blocks to the most current, then be notified of new subsequent
blocks being created:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">replayPastAndFutureBlocksFlowable</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">startBlockNumber</span><span class="o">&gt;,</span> <span class="o">&lt;</span><span class="n">fullTxObjects</span><span class="o">&gt;)</span>
        <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">block</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>As above, but with transactions contained within blocks:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Subscription</span> <span class="n">subscription</span> <span class="o">=</span> <span class="n">web3j</span><span class="o">.</span><span class="na">replayPastAndFutureTransactionsFlowable</span><span class="o">(</span>
        <span class="o">&lt;</span><span class="n">startBlockNumber</span><span class="o">&gt;)</span>
        <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">tx</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>All of the above filters are exported via the
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/core/src/main/java/org/web3j/protocol/rx/Web3jRx.java">Web3jRx</a>
interface.</p>
</div>
<div class="section" id="topic-filters-and-evm-events">
<span id="id2"></span><h2>Topic filters and EVM events<a class="headerlink" href="#topic-filters-and-evm-events" title="Permalink to this headline">¶</a></h2>
<p>Topic filters capture details of Ethereum Virtual Machine (EVM) events taking place in the network.
These events are created by smart contracts and stored in the transaction log associated with a
smart contract.</p>
<p>The <a class="reference external" href="http://solidity.readthedocs.io/en/develop/contracts.html#events">Solidity documentation</a>
provides a good overview of EVM events.</p>
<p>You use the
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/core/src/main/java/org/web3j/protocol/core/methods/request/EthFilter.java">EthFilter</a>
type to specify the topics that you wish to apply to the filter. This can include the address of
the smart contract you wish to apply the filter to. You can also provide specific topics to filter
on. Where the individual topics represent indexed parameters on the smart contract:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">EthFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EthFilter</span><span class="o">(</span><span class="n">DefaultBlockParameterName</span><span class="o">.</span><span class="na">EARLIEST</span><span class="o">,</span>
        <span class="n">DefaultBlockParameterName</span><span class="o">.</span><span class="na">LATEST</span><span class="o">,</span> <span class="o">&lt;</span><span class="n">contract</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;)</span>
             <span class="o">[.</span><span class="na">addSingleTopic</span><span class="o">(...)</span> <span class="o">|</span> <span class="o">.</span><span class="na">addOptionalTopics</span><span class="o">(...,</span> <span class="o">...)</span> <span class="o">|</span> <span class="o">...];</span>
</pre></div>
</div>
<p>This filter can then be created using a similar syntax to the block and transaction filters above:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">web3j</span><span class="o">.</span><span class="na">ethLogFlowable</span><span class="o">(</span><span class="n">filter</span><span class="o">).</span><span class="na">subscribe</span><span class="o">(</span><span class="n">log</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">});</span>
</pre></div>
</div>
<p>The filter topics can only refer to the indexed Solidity event parameters. It is not possible to
filter on the non-indexed event parameters. Additionally, for any indexed event parameters that are
variable length array types such as string and bytes, the Keccak-256 hash of their value is stored
on the EVM log. It is not possible to store or filter using their full value.</p>
<p>If you create a filter instance with no topics associated with it, all EVM events taking place in
the network will be captured by the filter.</p>
</div>
<div class="section" id="a-note-on-functional-composition">
<h2>A note on functional composition<a class="headerlink" href="#a-note-on-functional-composition" title="Permalink to this headline">¶</a></h2>
<p>In addition to <em>send()</em> and <em>sendAsync</em>, all JSON-RPC method implementations in web3j support the
<em>flowable()</em> method to create a Flowable to execute the request asynchronously. This makes it
very straight forwards to compose JSON-RPC calls together into new functions.</p>
<p>For instance, the
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/core/src/main/java/org/web3j/protocol/rx/JsonRpc2_0Rx.java">blockFlowable</a> is
itself composed of a number of separate JSON-RPC calls:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">Flowable</span><span class="o">&lt;</span><span class="n">EthBlock</span><span class="o">&gt;</span> <span class="nf">blockFlowable</span><span class="o">(</span>
        <span class="kt">boolean</span> <span class="n">fullTransactionObjects</span><span class="o">,</span> <span class="kt">long</span> <span class="n">pollingInterval</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ethBlockHashFlowable</span><span class="o">(</span><span class="n">pollingInterval</span><span class="o">)</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">blockHash</span> <span class="o">-&gt;</span>
                    <span class="n">web3j</span><span class="o">.</span><span class="na">ethGetBlockByHash</span><span class="o">(</span><span class="n">blockHash</span><span class="o">,</span> <span class="n">fullTransactionObjects</span><span class="o">).</span><span class="na">flowable</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here we first create a flowable that provides notifications of the block hash of each newly
created block. We then use <em>flatMap</em> to invoke a call to <em>ethGetBlockByHash</em> to obtain the full
block details which is what is passed to the subscriber of the flowable.</p>
</div>
<div class="section" id="further-examples">
<h2>Further examples<a class="headerlink" href="#further-examples" title="Permalink to this headline">¶</a></h2>
<p>Please refer to the integration test
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/integration-tests/src/test/java/org/web3j/protocol/core/FlowableIT.java">FlowableIT</a>
for further examples.</p>
<p>For a demonstration of using the manual filter API, you can take a look at the test
<a class="reference external" href="https://github.com/web3j/web3j/blob/master/integration-tests/src/test/java/org/web3j/protocol/scenarios/EventFilterIT.java">EventFilterIT</a>..</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/web3j.png" alt="Logo"/>
    
    <h1 class="logo logo-name">web3j</h1>
    
  </a>
</p>



<p class="blurb">Lightweight Java library for integration with Ethereum clients</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=web3j&repo=web3j&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/web3j/web3j">
    <img
        alt="https://secure.travis-ci.org/web3j/web3j.svg?branch=master"
        src="https://secure.travis-ci.org/web3j/web3j.svg?branch=master"
    />
</a>
</p>




    

<p>
<a class="badge" href="https://codecov.io/github/web3j/web3j">
    <img
    alt="https://codecov.io/github/web3j/web3j/coverage.svg?branch=master"
    src="https://codecov.io/github/web3j/web3j/coverage.svg?branch=master"
    />
</a>
</p>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="smart_contracts.html">Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="abi.html">Application Binary Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlp.html">Recursive Length Prefix</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Filters and Events</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#block-and-transaction-filters">Block and transaction filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replay-filters">Replay filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#topic-filters-and-evm-events">Topic filters and EVM events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-note-on-functional-composition">A note on functional composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-examples">Further examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">Command Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="management_apis.html">Management APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="infura.html">Using Infura with web3j</a></li>
<li class="toctree-l1"><a class="reference internal" href="ens.html">Ethereum Name Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="trouble.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects using web3j</a></li>
<li class="toctree-l1"><a class="reference internal" href="companies.html">Companies using web3j</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html">Links and Useful Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Thanks and Credits</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="rlp.html" title="previous chapter">Recursive Length Prefix</a></li>
      <li>Next: <a href="command_line.html" title="next chapter">Command Line Tools</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2018, Conor Svensson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/filters.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/web3j/web3j" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-85710619-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>